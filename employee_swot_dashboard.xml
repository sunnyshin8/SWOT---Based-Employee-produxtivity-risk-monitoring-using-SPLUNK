<dashboard version="1.1">
  <label>Employee Productivity SWOT Analysis Dashboard</label>
  <description>Real-time monitoring of employee productivity using the SWOT framework with MLTK clustering</description>

  <!-- Filters -->
  <fieldset submitButton="true" autoRun="true">
    <input type="time" token="time_range">
      <label>Time Range</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>

    <input type="dropdown" token="department_filter">
      <label>Department</label>
      <choice value="*">All Departments</choice>
      <choice value="IT">IT</choice>
      <choice value="Engineering">Engineering</choice>
      <choice value="Sales">Sales</choice>
      <choice value="Marketing">Marketing</choice>
      <choice value="Finance">Finance</choice>
      <choice value="HR">HR</choice>
      <choice value="Operations">Operations</choice>
      <choice value="Customer Support">Customer Support</choice>
      <choice value="Legal">Legal</choice>
      <default>*</default>
    </input>
  </fieldset>

  <!-- SWOT Pie -->
  <row>
    <panel>
      <title>SWOT Distribution Overview</title>
      <chart>
        <search>
          <query>
            index=employee_productivity sourcetype=csv
            | search Department=$department_filter$
            | eval productivity_score=round((Performance_Score*2+(Work_Hours_Per_Week/40)+(Projects_Handled/10)+(Training_Hours/50)-(Sick_Days/5)+(Employee_Satisfaction_Score/5))/6,2)
            | eval engagement_score=round((Employee_Satisfaction_Score+(Training_Hours/10)+(Promotions*2)-(Sick_Days*0.5))/4,2)
            | eval risk_score=round((Sick_Days+Overtime_Hours/10+if(Resigned=="True",5,0)+(5-Performance_Score)-Employee_Satisfaction_Score)/5,2)
            | eval swot_category=case(
                productivity_score&gt;=3.5 AND engagement_score&gt;=3.5 AND risk_score&lt;=2, "Strength",
                productivity_score&lt;2.5 OR engagement_score&lt;2.5 OR risk_score&gt;=4, "Threat",
                (productivity_score&gt;=2.5 AND productivity_score&lt;3.5) AND (engagement_score&gt;=2.5 AND engagement_score&lt;3.5), "Weakness",
                1=1, "Opportunity"
              )
            | stats count by swot_category
            | eval percentage=round((count/sum(count))*100,1)
          </query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.showPercent">true</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.seriesColors">[0x65A637, 0xF7BC38, 0x6DB7C6, 0xD93F3C]</option>
      </chart>
    </panel>

    <panel>
      <title>Total Employees</title>
      <single>
        <search>
          <query>
            index=employee_productivity sourcetype=csv
            | search Department=$department_filter$
            | stats dc(Employee_ID) as total_employees
          </query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
      </single>
    </panel>

    <panel>
      <title>High Risk Employees (Threats)</title>
      <single>
        <search>
          <query>
            index=employee_productivity sourcetype=csv
            | search Department=$department_filter$
            | eval productivity_score=round((Performance_Score*2+(Work_Hours_Per_Week/40)+(Projects_Handled/10)+(Training_Hours/50)-(Sick_Days/5)+(Employee_Satisfaction_Score/5))/6,2)
            | eval engagement_score=round((Employee_Satisfaction_Score+(Training_Hours/10)+(Promotions*2)-(Sick_Days*0.5))/4,2)
            | eval risk_score=round((Sick_Days+Overtime_Hours/10+if(Resigned=="True",5,0)+(5-Performance_Score)-Employee_Satisfaction_Score)/5,2)
            | eval swot_category=case(
                productivity_score&gt;=3.5 AND engagement_score&gt;=3.5 AND risk_score&lt;=2, "Strength",
                productivity_score&lt;2.5 OR engagement_score&lt;2.5 OR risk_score&gt;=4, "Threat",
                (productivity_score&gt;=2.5 AND productivity_score&lt;3.5) AND (engagement_score&gt;=2.5 AND engagement_score&lt;3.5), "Weakness",
                1=1, "Opportunity"
              )
            | stats count(eval(swot_category=="Threat")) as high_risk
          </query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
      </single>
    </panel>

    <panel>
      <title>Average Satisfaction Score</title>
      <single>
        <search>
          <query>
            index=employee_productivity sourcetype=csv 
            | search Department=$department_filter$
            | stats avg(Employee_Satisfaction_Score) as score
            | eval score=round(score,2)
          </query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
      </single>
    </panel>
  </row>

  <!-- Department Risk Table -->
  <row>
    <panel>
      <title>Department SWOT Breakdown</title>
      <table>
        <search>
          <query>
            index=employee_productivity sourcetype=csv
            | eval productivity_score=round((Performance_Score*2+(Work_Hours_Per_Week/40)+(Projects_Handled/10)+(Training_Hours/50)-(Sick_Days/5)+(Employee_Satisfaction_Score/5))/6,2)
            | eval engagement_score=round((Employee_Satisfaction_Score+(Training_Hours/10)+(Promotions*2)-(Sick_Days*0.5))/4,2)
            | eval risk_score=round((Sick_Days+Overtime_Hours/10+if(Resigned=="True",5,0)+(5-Performance_Score)-Employee_Satisfaction_Score)/5,2)
            | eval swot_category=case(
                productivity_score&gt;=3.5 AND engagement_score&gt;=3.5 AND risk_score&lt;=2, "Strength",
                productivity_score&lt;2.5 OR engagement_score&lt;2.5 OR risk_score&gt;=4, "Threat",
                (productivity_score&gt;=2.5 AND productivity_score&lt;3.5) AND (engagement_score&gt;=2.5 AND engagement_score&lt;3.5), "Weakness",
                1=1, "Opportunity"
              )
            | stats count(eval(swot_category="Strength")) as Strengths, count(eval(swot_category="Weakness")) as Weaknesses, count(eval(swot_category="Opportunity")) as Opportunities, count(eval(swot_category="Threat")) as Threats by Department
          </query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
      </table>
    </panel>

    <panel>
      <title>Risk vs Productivity Scatter</title>
      <chart>
        <search>
          <query>
            index=employee_productivity sourcetype=csv
            | search Department=$department_filter$
            | eval productivity_score=round((Performance_Score*2+(Work_Hours_Per_Week/40)+(Projects_Handled/10)+(Training_Hours/50)-(Sick_Days/5)+(Employee_Satisfaction_Score/5))/6,2)
            | eval risk_score=round((Sick_Days+Overtime_Hours/10+if(Resigned=="True",5,0)+(5-Performance_Score)-Employee_Satisfaction_Score)/5,2)
            | table Employee_ID, productivity_score, risk_score
          </query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
        <option name="charting.chart">scatter</option>
        <option name="charting.axisTitleX.text">Productivity Score</option>
        <option name="charting.axisTitleY.text">Risk Score</option>
      </chart>
    </panel>
  </row>
</dashboard>
